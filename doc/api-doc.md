# 答案之书小程序 API 文档

## 接口规范

### 基础信息

- **基础URL**: `https://api.answerbook.example.com/v1`
- **请求方式**: REST风格API
- **数据格式**: JSON
- **字符编码**: UTF-8
- **时间格式**: ISO 8601 (YYYY-MM-DDTHH:mm:ss.sssZ)

### 认证方式

小程序使用微信登录认证，通过以下步骤获取认证信息：

1. 小程序端调用 `wx.login()` 获取临时登录凭证 code
2. 将 code 发送至后端服务器
3. 后端服务器调用微信接口获取 session_key 和 openid
4. 后端生成自定义登录态 token 返回给小程序
5. 小程序后续请求携带 token 进行身份验证

### 响应格式

```json
{
  "code": 0,           // 状态码，0表示成功，非0表示失败
  "message": "成功",  // 状态描述
  "data": {}          // 响应数据
}
```

### 状态码

| 状态码 | 描述 |
|--------|------|
| 0 | 成功 |
| 1001 | 参数错误 |
| 1002 | 未授权 |
| 2001 | 服务器内部错误 |
| 3001 | 资源不存在 |

---

## API 列表

### 1. 用户认证

#### 1.1 登录接口

- **接口**: `/auth/login`
- **方法**: POST
- **描述**: 小程序登录获取token

**请求参数**:

| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| code | String | 是 | 微信临时登录凭证 |

**响应示例**:

```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "expires_in": 7200
  }
}
```

### 2. 答案相关

#### 2.1 获取随机答案

- **接口**: `/answers/random`
- **方法**: GET
- **描述**: 获取随机答案

**请求参数**:

| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| question | String | 否 | 用户提问内容（用于日志记录，不影响答案生成） |

**响应示例**:

```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "answer_id": 42,
    "content": "相信你的直觉",
    "created_at": "2023-05-20T08:30:45.123Z"
  }
}
```

#### 2.2 获取指定ID的答案

- **接口**: `/answers/{id}`
- **方法**: GET
- **描述**: 获取指定ID的答案

**路径参数**:

| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| id | Integer | 是 | 答案ID |

**响应示例**:

```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "answer_id": 42,
    "content": "相信你的直觉",
    "created_at": "2023-05-20T08:30:45.123Z"
  }
}
```

### 3. 每日一言

#### 3.1 获取每日一言

- **接口**: `/daily-quotes/today`
- **方法**: GET
- **描述**: 获取今日的哲理/幽默语录

**请求参数**: 无

**响应示例**:

```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "quote_id": 15,
    "content": "生活中最重要的不是你所处的位置，而是你所朝的方向。",
    "author": "奥利弗·温德尔·霍姆斯",
    "date": "2023-05-20"
  }
}
```

### 4. 用户行为

#### 4.1 记录用户行为

- **接口**: `/user-behaviors`
- **方法**: POST
- **描述**: 记录用户行为日志

**请求参数**:

| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| behavior_type | String | 是 | 行为类型，可选值：view(查看)、share(分享)、feedback(反馈) |
| target_id | Integer | 是 | 目标ID，如答案ID、每日一言ID等 |
| target_type | String | 是 | 目标类型，可选值：answer(答案)、daily_quote(每日一言) |
| extra | Object | 否 | 额外信息，如分享平台、反馈内容等 |

**响应示例**:

```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "behavior_id": 1001
  }
}
```

### 5. 分享

#### 5.1 生成分享图片

- **接口**: `/shares/generate`
- **方法**: POST
- **描述**: 生成分享海报图片

**请求参数**:

| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| answer_id | Integer | 是 | 答案ID |
| background_id | Integer | 否 | 背景图ID，不传则使用默认背景 |

**响应示例**:

```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "share_id": 501,
    "image_url": "https://static.answerbook.example.com/shares/501.jpg",
    "created_at": "2023-05-20T10:15:30.456Z",
    "expires_at": "2023-05-27T10:15:30.456Z"
  }
}
```

---

## 错误码详细说明

| 错误码 | 错误信息 | 描述 |
|--------|----------|------|
| 1001 | 参数错误 | 请求参数不符合要求 |
| 1002 | 未授权 | 用户未登录或token已过期 |
| 1003 | 操作频繁 | 用户操作过于频繁，请稍后再试 |
| 2001 | 服务器内部错误 | 服务器处理请求时发生错误 |
| 3001 | 资源不存在 | 请求的资源不存在 |
| 3002 | 答案不存在 | 请求的答案不存在 |
| 3003 | 每日一言不存在 | 请求的每日一言不存在 |

## 更新日志

| 版本 | 日期 | 描述 |
|------|------|------|
| v1.0.0 | - | 初始版本 |